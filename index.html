<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</title>

<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
* { font-family: 'Sarabun', sans-serif; font-weight: bold; box-sizing: border-box; }
body { margin:0; background:#ffc0cb; }
nav { background:#ff69b4; padding:10px; text-align:center; }
nav button {
    margin:5px; padding:10px 18px; border:none;
    background:#ffe4e1; color:red; font-size:20px;
    border-radius:10px; cursor:pointer;
}
section { display:none; padding:20px; }
section.active { display:block; }
.card { background:white; padding:20px; border-radius:15px; margin-bottom:20px; }
.center { text-align:center; }
.count { font-size:26px; color:red; }
video { width:100%; border-radius:10px; border:3px solid pink; }
table { border-collapse: collapse; }
th, td { padding:8px; text-align:center; }
</style>
</head>

<body>

<nav>
    <button onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    <button onclick="showPage('detect')">üé• ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</button>
    <button onclick="showPage('stats')">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
    <button onclick="showPage('data')">üìÅ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</nav>

<section id="home" class="active">
    <div class="card center">
        <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h1>
        <p>Bag Type Detection & Counting (YOLO)</p>
        <button onclick="showPage('detect')">üëâ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
    </div>
</section>

<section id="detect">
    <div class="card">
        <h2>üé• ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</h2>
        <video id="camera" autoplay></video><br><br>
        <button onclick="startCamera()">üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
    </div>

    <div class="card">
        <h3>üì¶ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö (Real-time)</h3>
        <p>üéí Backpack: <span id="backpack" class="count">0</span></p>
        <p>üëú Handbag: <span id="handbag" class="count">0</span></p>
        <p>üß≥ Suitcase: <span id="suitcase" class="count">0</span></p>
        <p>üìä ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="total" class="count">0</span></p>
    </div>
</section>

<section id="stats">
    <div class="card">
        <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</h2>
        <canvas id="chart"></canvas>
    </div>
</section>

<section id="data">
    <div class="card">
        <h2>üìÅ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</h2>
        <table border="1" width="100%">
            <thead>
                <tr>
                    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                    <th>Backpack</th>
                    <th>Handbag</th>
                    <th>Suitcase</th>
                    <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                </tr>
            </thead>
            <tbody id="dataTable"></tbody>
        </table>
    </div>
</section>

<script>
function showPage(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

function startCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => camera.srcObject = stream)
        .catch(() => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ"));
}

let index = 1;

// ====== Chart ======
const chart = new Chart(document.getElementById("chart"), {
    type: "bar",
    data: {
        labels: ["backpack", "handbag", "suitcase"],
        datasets: [{
            label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö",
            data: [0, 0, 0],
            backgroundColor: ["#ff9999", "#ff66b2", "#ff3399"]
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: { beginAtZero: true }
        }
    }
});

// ====== ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å YOLO Backend ======
async function detectFromYOLO() {
    try {
        const res = await fetch("http://127.0.0.1:5000/detect");
        const data = await res.json();

        const backpack = data.backpack || 0;
        const handbag = data.handbag || 0;
        const suitcase = data.suitcase || 0;
        const total = backpack + handbag + suitcase;

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤ detect
        document.getElementById("backpack").innerText = backpack;
        document.getElementById("handbag").innerText = handbag;
        document.getElementById("suitcase").innerText = suitcase;
        document.getElementById("total").innerText = total;

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü
        chart.data.datasets[0].data = [backpack, handbag, suitcase];
        chart.update();

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        if (total > 0) {
            const row = dataTable.insertRow();
            row.innerHTML = `
                <td>${index++}</td>
                <td>${backpack}</td>
                <td>${handbag}</td>
                <td>${suitcase}</td>
                <td>${new Date().toLocaleTimeString()}</td>
            `;
        }

    } catch (err) {
        console.log("‚ùå Backend ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô");
    }
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
setInterval(detectFromYOLO, 2000);
</script>

</body>
</html>
