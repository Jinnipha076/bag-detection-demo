import cv2
import streamlit as st
from ultralytics import YOLO

st.title("YOLO Hand Gesture Detection üëç ‚úåÔ∏è")

# ======================
# Session State
# ======================
if "running" not in st.session_state:
    st.session_state.running = False
if "like_count" not in st.session_state:
    st.session_state.like_count = 0
if "victory_count" not in st.session_state:
    st.session_state.victory_count = 0

# ======================
# ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
# ======================
col1, col2, col3 = st.columns(3)

with col1:
    if st.button("Start"):
        st.session_state.running = True

with col2:
    if st.button("Stop"):
        st.session_state.running = False

with col3:
    if st.button("Reset"):
        st.session_state.like_count = 0
        st.session_state.victory_count = 0

# ======================
# ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
# ======================
if st.session_state.running:
    st.markdown("### üü¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
else:
    st.markdown("### üî¥ ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")

frame_window = st.image([])

# ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• YOLO
model = YOLO("best.pt")

cap = cv2.VideoCapture(0)

while st.session_state.running:
    success, frame = cap.read()
    if not success:
        st.write("Camera error")
        break

    results = model(frame)

    for r in results:
        boxes = r.boxes
        for box in boxes:
            cls = int(box.cls[0])
            label = model.names[cls]

            x1, y1, x2, y2 = map(int, box.xyxy[0])

            cv2.rectangle(frame, (x1, y1), (x2, y2), (0,255,0), 2)
            cv2.putText(frame, label, (x1, y1-10),
                        cv2.FONT_HERSHEY_SIMPLEX, 1, (0,255,0), 2)

            if label.lower() == "like":
                st.session_state.like_count += 1
            elif label.lower() == "victory":
                st.session_state.victory_count += 1

    cv2.putText(frame, f"Like: {st.session_state.like_count}", (10, 40),
                cv2.FONT_HERSHEY_SIMPLEX, 1, (255,0,0), 2)

    cv2.putText(frame, f"Victory: {st.session_state.victory_count}", (10, 80),
                cv2.FONT_HERSHEY_SIMPLEX, 1, (0,0,255), 2)

    frame_window.image(cv2.cvtColor(frame, cv2.COLOR_BGR2RGB))

cap.release()