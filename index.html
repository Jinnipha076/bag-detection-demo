<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</title>

<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
* { font-family: 'Sarabun', sans-serif; font-weight: bold; box-sizing: border-box; }
body { margin:0; background:#ffc0cb; }
nav { background:#ff69b4; padding:10px; text-align:center; }
nav button {
    margin:5px; padding:10px 18px; border:none;
    background:#ffe4e1; color:red; font-size:20px;
    border-radius:10px; cursor:pointer;
}
section { display:none; padding:20px; }
section.active { display:block; }
.card { background:white; padding:20px; border-radius:15px; margin-bottom:20px; }
.center { text-align:center; }
.count { font-size:28px; color:red; }
video { width:100%; border-radius:10px; border:3px solid pink; }
</style>
</head>

<body>

<nav>
    <button onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    <button onclick="showPage('detect')">üé• ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</button>
    <button onclick="showPage('stats')">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
    <button onclick="showPage('data')">üìÅ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</nav>

<section id="home" class="active">
    <div class="card center">
        <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h1>
        <p>‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ Computer Vision</p>
        <button onclick="showPage('detect')">üëâ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
    </div>
</section>

<section id="detect">
    <div class="card">
        <h2>üé• ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</h2>
        <video id="camera" autoplay></video><br><br>
        <button onclick="startCamera()">üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
    </div>

    <div class="card">
        <h3>üì¶ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</h3>
        <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö: <span id="bagCount" class="count">0</span></p>
        <p>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: <span id="bagType">-</span></p>
    </div>
</section>

<section id="stats">
    <div class="card">
        <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
        <canvas id="chart"></canvas>
    </div>
</section>

<section id="data">
    <div class="card">
        <h2>üìÅ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</h2>
        <table border="1" width="100%">
            <tr><th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th></tr>
            <tbody id="dataTable"></tbody>
        </table>
    </div>
</section>

<script>
function showPage(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

function startCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => camera.srcObject = stream)
        .catch(() => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ"));
}

let index = 1;
let chartData = [0,0,0];

const chart = new Chart(document.getElementById("chart"), {
    type: "bar",
    data: {
        labels: ["backpack","handbag","suitcase"],
        datasets: [{
            label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö",
            data: chartData,
            backgroundColor: "pink"
        }]
    }
});

async function detectFromYOLO() {
    try {
        const res = await fetch("http://127.0.0.1:5000/detect");
        const data = await res.json();

        if (data.found) {
            document.getElementById("bagCount").innerText = data.count;
            document.getElementById("bagType").innerText = data.type;

            const row = dataTable.insertRow();
            row.innerHTML = `<td>${index++}</td><td>${data.type}</td><td>${new Date().toLocaleTimeString()}</td>`;

            const i = chart.data.labels.indexOf(data.type);
            if (i >= 0) {
                chart.data.datasets[0].data[i]++;
                chart.update();
            }
        }
    } catch {
        console.log("Backend ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô");
    }
}

setInterval(detectFromYOLO, 2000);
</script>

</body>
</html>
